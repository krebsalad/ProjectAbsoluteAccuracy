<launch>

  <!-- capture arguments -->
  <arg name="rviz" default="true"/>
  <arg name="ip" default="172.22.31.3"/>
  <arg name="robot"  default="fieldlab_cel3_calib" />
  <arg name="manual" default="false"/>

  <!-- static args -->
  <arg name="robot_package_path" value="(find $(arg robot))" />
  <arg name="dollar" value="$" />
  
  <!-- Robot calibration capture launch -->
  <group if="$(arg manual)">
    <rosparam command="delete" param="robot_calibration" />
    <node pkg="robot_calibration" type="calibrate" name="capture"
          args="--manual"
          output="screen" required="true" launch-prefix="xterm -e">
      <rosparam file="$(arg dollar)$(arg robot_package_path)/config/capture.yaml" command="load"/>
    </node>
  </group>

  <group unless="$(arg manual)">
    <rosparam command="delete" param="robot_calibration" />
    <node pkg="robot_calibration" type="calibrate" name="robot_calibration"
          args="$(arg dollar)$(arg robot_package_path)/config/calibration_poses.bag"
          output="screen" required="true" launch-prefix="xterm -e">
      <rosparam file="$(arg dollar)$(arg robot_package_path)/config/capture.yaml" command="load" />
    </node>
  </group>

  <node pkg="rosbag" type="record" name="calibration_bagger" output="screen"
        args="--bz2 -o /tmp/abb_robot_calibration/calibration_data calibration_data robot_description" >
    <param name="mkdir_tmp" command="mkdir -m 777 -p /tmp/abb_robot_calibration" />
  </node>

  <!-- launch robot_cal.launch from robot package -->
  <include file="$(arg dollar)$(arg robot_package_path)/launch/robot_cal.launch">
    <arg name="robot_ip" value="$(arg ip)"/>
    <arg name="rviz_planner" value="$(arg rviz)"/>
    <arg name="camera_launch" value="true"/>
  </include>


</launch>
